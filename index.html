<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv='Content-type' content='text/html; charset=utf-8'>
    <title>List Component</title>
    <link rel="stylesheet" href="../shared/css/base.css" />
  </head>
  <body>
    <h1>List Component</h1>
    <div id="list">
      <p>
        If you can see this, the app is not working right.
      </p>
    </div>
    <script
src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js">
    </script>
    <script
src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js">
    </script>
    <script src="./shared/thirdparty/console-polyfill.js"></script>
    <script src="./build/react.js"></script>
    <script src="./build/react-dom.js"></script>
    <script src="../../build/JSXTransformer.js"></script>
    <script type="text/jsx">
      /**
       * @jsx React.DOM
       */
      var start = new Date().getTime();

      //example class for subitems, taken from React tutorial
      var Comment = React.createClass({
      rawMarkup: function() {
      var rawMarkup = marked(this.props.data.toString(), {sanitize:
        true});
      return { __html: rawMarkup };
      },
      
      render: function() {
      return (
        <div className="comment">
          <h2 className="commentAuthor">
            {this.props.author}
          </h2>
          <span dangerouslySetInnerHTML={this.rawMarkup()} />
        </div>
        );
      }
      });
      var ListComponent = React.createClass({
        render: function() {
          var containerTag = this.props.containerTag.toString();
          var data = this.props.data;
          var message = "List contains " + data.length + " elements";
          return React.createElement(containerTag, {},
              data.map(function(dataUnit){
                return React.createElement(dataUnit.klass, 
                  {data: dataUnit.value, key: dataUnit.key});
              })
          );
        }
      });

      function shuffle(o){
        for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = 
        o[--i], o[i] = o[j], o[j] = x);
        return o;
      }
      function someData() {
        return shuffle([{klass: Comment,
          value:5, key:1},
            {klass: Comment, value:4, key:2}, {klass: Comment, 
            value:"**bold** move", key:3}, {klass: Comment, value:3, key:4}, 
            {klass: Comment, key: 5,
            value: ((new Date().getTime() - start)/1000).toFixed()}]);
      }
      var ListComponentFactory = React.createFactory(ListComponent);
      setInterval(function() {
        ReactDOM.render(
          ListComponentFactory({containerTag: 'div', data: someData()}),
          document.getElementById('list')
        );
      }, 500);
    </script>
  </body>
</html>
